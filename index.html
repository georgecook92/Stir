<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">

    <link rel="stylesheet" href="/style/material.green-light_blue.min.css">
    <script src="/js/material.min.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">

    <link rel="stylesheet" href="/style/style.css">
    <link rel="manifest" href="/manifest.json">

    <script src="https://cdn.onesignal.com/sdks/OneSignalSDK.js" async></script>
    <script>
    var OneSignal = OneSignal || [];
    OneSignal.push(["init", {
      appId: "04954d84-8b33-4124-98cb-ac53f5abcf1d",
      autoRegister: true,
      notifyButton: {
        enable: true /* Set to false to hide */
      }
    }]);

  </script>

  </head>
  <body>
    <div class="container"></div>
    <div id="demo-toast-example" class="mdl-js-snackbar mdl-snackbar">
      <div class="mdl-snackbar__text"></div>
      <button class="mdl-snackbar__action" type="button"></button>
    </div>
  </body>
  <script src="/bundle.js"></script>
  <script>

  if (navigator.serviceWorker) {
    if (!navigator.serviceWorker.controller) {
      // No service worker is controlling this page
      // At some point in time in the future, depending on whether OneSignal is set to autoRegister or not, the service worker will be installed.
      // Wait for that point
      navigator.serviceWorker.ready.then(function(registration) {
          if (registration.active) {
               // Display your message
               console.log('ACTIVE');
               (function() {
                  'use strict';

                  var snackbarContainer = document.querySelector('#demo-toast-example');

                  'use strict';
                  var data = {message: 'This web app in now available offline' };
                  snackbarContainer.MaterialSnackbar.showSnackbar(data);

                }());
          } else {
            //Message from OneSignal Support
            // Because we use skipWaiting() and clients.claim(), although the service worker does pass through the "installing" state on the way to becoming "active", it should never stay on this state and you should only ever see it "active". You shouldn't see "waiting" either. I'm not too sure on this part, but this should be the case.
          }
      });
    } else {
  // OneSignal+your service worker is already active and controlling this page
  // Your SW caching content and intercepting page requests is active and working at this point
      }
  }



</script>

<script>
OneSignal.push(function() {
  OneSignal.on('subscriptionChange', function(isSubscribed) {
    if (isSubscribed) {
      // The user is subscribed
      //   Either the user subscribed for the first time
      //   Or the user was subscribed -> unsubscribed -> subscribed
      OneSignal.getUserId( function(userId) {
        // Make a POST call to your server with the user ID
        console.log('user_id:',userId);
        localStorage.setItem('userPushId', userId);
      });
    } else {
      localStorage.removeItem('userPushId');
    }
  });
});


</script>
</html>
